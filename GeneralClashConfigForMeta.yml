# æ··åˆç«¯å£ HTTPå’ŒSOCKS5ç”¨ä¸€ä¸ªç«¯å£
mixed-port: 7890

# Linux å’Œ macOS çš„ redir ä»£ç†ç«¯å£ (å¦‚éœ€ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·å–æ¶ˆæ³¨é‡Š)
# redir-port: 7892

# Transparent proxy server port for Linux (TProxy TCP and TProxy UDP)
tproxy-port: 7893

geodata-mode: true         #ã€Metaä¸“å±ã€‘ä½¿ç”¨geoip.datæ•°æ®åº“(é»˜è®¤ï¼šfalseä½¿ç”¨mmdbæ•°æ®åº“)
tcp-concurrent: true         #ã€Metaä¸“å±ã€‘TCPè¿æ¥å¹¶å‘ï¼Œå¦‚æœåŸŸåè§£æç»“æœå¯¹åº”å¤šä¸ªIPï¼Œ
                             # å¹¶å‘æ‰€æœ‰IPï¼Œé€‰æ‹©æ¡æ‰‹æœ€å¿«çš„IPè¿›è¡Œè¿æ¥

# å…è®¸å±€åŸŸç½‘çš„è¿æ¥ï¼ˆå¯ç”¨æ¥å…±äº«ä»£ç†ï¼‰
allow-lan: true

bind-address: "*"
ipv6: true # å¼€å¯ IPv6 æ€»å¼€å…³ï¼Œå…³é—­é˜»æ–­æ‰€æœ‰ IPv6 é“¾æ¥å’Œå±è”½ DNS è¯·æ±‚ AAAA è®°å½•

#  find-process-mode has 3 values:always, strict, off
#  - always, å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
#  - strict, é»˜è®¤ï¼Œç”± clash åˆ¤æ–­æ˜¯å¦å¼€å¯
#  - off, ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
find-process-mode: strict
# è§„åˆ™æ¨¡å¼ï¼šruleï¼ˆè§„åˆ™ï¼‰ / globalï¼ˆå…¨å±€ä»£ç†ï¼‰/ directï¼ˆå…¨å±€ç›´è¿ï¼‰/ script (è„šæœ¬)
mode: rule
#è‡ªå®šä¹‰ geodata url
geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat"
  mmdb: "https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb"
geo-auto-update: true # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 24 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶

# è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ« (é»˜è®¤çº§åˆ«ï¼šsilentï¼Œå³ä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œä»¥é¿å…å› æ—¥å¿—å†…å®¹è¿‡å¤§è€Œå¯¼è‡´ç¨‹åºå†…å­˜æº¢å‡ºï¼‰ã€‚
# 5 ä¸ªçº§åˆ«ï¼šsilent / error / warning / info / debugã€‚çº§åˆ«è¶Šé«˜æ—¥å¿—è¾“å‡ºé‡è¶Šå¤§ï¼Œè¶Šå€¾å‘äºè°ƒè¯•ï¼Œè‹¥éœ€è¦è¯·è‡ªè¡Œå¼€å¯ã€‚
log-level: debug

# Clash çš„ RESTful API
external-controller: '127.0.0.1:7921'

# å®éªŒæ€§åŠŸèƒ½
experimental:
  ignore-resolve-fail: true # å¿½ç•¥ DNS è§£æå¤±è´¥ï¼Œé»˜è®¤å€¼ä¸º true
  # interface-name: en0 # outbound interface name

# å…¨å±€ TLS æŒ‡çº¹ï¼Œä¼˜å…ˆä½äº proxy å†…çš„ client-fingerprint
# å¯é€‰ï¼š "chrome","firefox","safari","ios","random","none" options.
# Utls is currently support TLS transport in TCP/grpc/WS/HTTP for VLESS/Vmess and trojan.
global-client-fingerprint: random

keep-alive-interval: 3600

profile: # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-selected: true
  # æŒä¹…åŒ– fake-ip
  store-fake-ip: true
unified-delay: true # æ›´æ¢å»¶è¿Ÿè®¡ç®—æ–¹å¼ï¼Œå»é™¤æ¡æ‰‹ç­‰é¢å¤–å»¶è¿Ÿ
# DNS åˆ†æµæ”¯æŒ GeoSite
dns:
  enable: true # æ˜¯å¦å¯ç”¨dns false
  prefer-h3: true # å¼€å¯ DoH æ”¯æŒ HTTP/3ï¼Œå°†å¹¶å‘å°è¯•
  cache-algorithm: arc
  ipv6: true
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip       #DNSæ¨¡å¼(redir-host/fake-ip)
                                     #ã€Metaä¸“å±ã€‘redir-hostä¼ é€’åŸŸåï¼Œå¯è¿œç¨‹è§£æ
  fake-ip-range: 198.18.0.1/16 #
  fake-ip-filter: # fake ip ç™½åå•åˆ—è¡¨ï¼Œå¦‚æœä½ ä¸çŸ¥é“è¿™ä¸ªå‚æ•°çš„ä½œç”¨ï¼Œè¯·å‹¿ä¿®æ”¹
     #LAN
     - '*.lan'
     - '*.localdomain'
     - '*.example'
     - '*.invalid'
     - '*.localhost'
     - '*.test'
     - '*.local'
     - '*.home.arpa'
     #æ”¾è¡ŒNTPæœåŠ¡
     - time.*.com
     - time.*.gov
     - time.*.edu.cn
     - time.*.apple.com
     - time-ios.apple.com
     - time1.*.com
     - time2.*.com
     - time3.*.com
     - time4.*.com
     - time5.*.com
     - time6.*.com
     - time7.*.com
     - ntp.*.com
     - ntp1.*.com
     - ntp2.*.com
     - ntp3.*.com
     - ntp4.*.com
     - ntp5.*.com
     - ntp6.*.com
     - ntp7.*.com
     - '*.time.edu.cn'
     - '*.ntp.org.cn'
     - +.pool.ntp.org
     - time1.cloud.tencent.com
     #æ”¾è¡Œç½‘æ˜“äº‘éŸ³ä¹
     - music.163.com
     - '*.music.163.com'
     - '*.126.net'
#ç™¾åº¦éŸ³ä¹
     - musicapi.taihe.com
     - music.taihe.com
#é…·ç‹—éŸ³ä¹
     - songsearch.kugou.com
     - trackercdn.kugou.com
#é…·æˆ‘éŸ³ä¹
     - '*.kuwo.cn'
#JOOXéŸ³ä¹
     - api-jooxtt.sanook.com
     - api.joox.com
     - joox.com
#QQéŸ³ä¹
     - y.qq.com
     - '*.y.qq.com'
     - streamoc.music.tc.qq.com
     - mobileoc.music.tc.qq.com
     - isure.stream.qqmusic.qq.com
     - dl.stream.qqmusic.qq.com
     - aqqmusic.tc.qq.com
     - amobile.music.tc.qq.com
#è™¾ç±³éŸ³ä¹
     - '*.xiami.com'
#å’ªå’•éŸ³ä¹
     - '*.music.migu.cn'
     - music.migu.cn
#win10æœ¬åœ°è¿æ¥æ£€æµ‹
     - +.msftconnecttest.com
     - +.msftncsi.com
#QQç™»å½•
     - localhost.ptlogin2.qq.com
     - localhost.sec.qq.com
     - +.qq.com
     - +.tencent.com
#Game
#Steam
     - +.steamcontent.com
#Nintendo Switch
     - +.srv.nintendo.net
     - '*.n.n.srv.nintendo.net'
     - +.cdn.nintendo.net
#Sony PlayStation
     - +.stun.playstation.net
#Microsoft Xbox
     - xbox.*.*.microsoft.com
     - '*.*.xboxlive.com'
     - xbox.*.microsoft.com
     - xnotify.xboxlive.com
#Wotgame
     - +.battlenet.com.cn
     - +.wotgame.cn
     - +.wggames.cn
     - +.wowsgame.cn
     - +.wargaming.net
#Golang
     - proxy.golang.org
#STUN
     - stun.*.*
     - stun.*.*.*
     - +.stun.*.*
     - +.stun.*.*.*
     - +.stun.*.*.*.*
     - +.stun.*.*.*.*.*
#Linksys Router
     - heartbeat.belkin.com
     - '*.linksys.com'
     - '*.linksyssmartwifi.com'
#ASUS Router
     - '*.router.asus.com'
#Apple Software Update Service
     - mesu.apple.com
     - swscan.apple.com
     - swquery.apple.com
     - swdownload.apple.com
     - swcdn.apple.com
     - swdist.apple.com
#Google
     - lens.l.google.com
     - stun.l.google.com
     - na.b.g-tun.com
#Netflix
     - +.nflxvideo.net
#FinalFantasy XIV Worldwide Server & CN Server
     - '*.square-enix.com'
     - '*.finalfantasyxiv.com'
     - '*.ffxiv.com'
     - '*.ff14.sdo.com'
     - ff.dorado.sdo.com
#Bilibili
     - '*.mcdn.bilivideo.cn'
#Disney Plus
     - +.media.dssott.com
#shark007 Codecs 
     - shark007.net
#Mijia
     - Mijia Cloud
#Xiaomi
     - weatherapi.market.xiaomi.com
#æ‹›å•†é“¶è¡Œ
     - +.cmbchina.com
     - +.cmbimg.com
#AdGuard
     - adguardteam.github.io
     - adrules.top
     - anti-ad.net
     - local.adguard.org
     - static.adtidy.org
#è¿…é›·
     - +.sandai.net
     - +.n0808.com
#T-mobile and Ultra Mobile wifi calling
     - +.3gppnetwork.org
#UU Plugin
     - +.uu.163.com
     - ps.res.netease.com
#å‘æ—¥è‘µè¿œç¨‹æ§åˆ¶
     - +.oray.com
     - WORKGROUP
  default-nameserver:
     - 'https://8.8.4.4/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'
     - 'https://1.0.0.1/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'
     - 'https://9.9.9.11/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'
  proxy-server-nameserver:          #ã€Metaä¸“å±ã€‘è§£æä»£ç†æœåŠ¡å™¨åŸŸåçš„dns           # ä¸å†™æ—¶ç”¨nameserverè§£æ
     - https://1.0.0.1/dns-query
     - https://8.8.4.4/dns-query
     - https://9.9.9.11/dns-query
     - https://185.222.222.222/dns-query
     - tls://45.11.45.11
  nameserver-policy:
    "geosite:cn,private,apple": 
      - https://223.5.5.5/dns-query
      - https://1.12.12.12/dns-query
      - tls://223.6.6.6
      - tls://1.12.12.12
  nameserver:
     - 'https://9.9.9.11/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'
     - 'https://185.222.222.222/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'
     - 'https://1.0.0.1/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'
     - 'https://8.8.4.4/dns-query#ğŸ”° èŠ‚ç‚¹é€‰æ‹©'

  fallback:
     - https://1.0.0.1/dns-query
     - https://8.8.4.4/dns-query
     - https://9.9.9.11/dns-query
     - https://185.222.222.222/dns-query
     - tls://1.0.0.1:853
     - tls://8.8.4.4:853
     - tls://9.9.9.9
     - tls://45.11.45.11
  fallback-filter:                   #å›è½DNSæœåŠ¡å™¨è¿‡æ»¤
     geoip: true                      #ä¸ºçœŸæ—¶ï¼Œä¸åŒ¹é…ä¸ºgeoipè§„åˆ™çš„ä½¿ç”¨fallbackè¿”å›ç»“æœ
     geoip-code: CN                   #geoipåŒ¹é…åŒºåŸŸè®¾å®š
     ipcidr:                          #åˆ—è¡¨ä¸­çš„ipä½¿ç”¨fallbackè¿”å›è§£æç»“æœ
      - 240.0.0.0/4
      - 127.0.0.1/32
      - 0.0.0.0/32
     domain:                          #åˆ—è¡¨ä¸­çš„åŸŸåä½¿ç”¨fallbackè¿”å›è§£æç»“æœ
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'

  use-hosts: true
  use-system-hosts: true

#ebpfé…ç½®
ebpf:
  auto-redir: # redirect æ¨¡å¼ï¼Œä»…æ”¯æŒ TCP
    - eth0
  redirect-to-tun: # UDP+TCP ä½¿ç”¨è¯¥åŠŸèƒ½è¯·å‹¿å¯ç”¨ auto-route
    - eth0
    
sniffer:
  enable: true
  ## å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  ## å¦‚ï¼šTunã€Redir å’Œ TProxy å¹¶ DNS ä¸º redir-host çš†å±äº
  # force-dns-mapping: false
  ## å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  # parse-pure-ip: false
  # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ true
  sniff: # TLS é»˜è®¤å¦‚æœä¸é…ç½® ports é»˜è®¤å—…æ¢ 443
    TLS:
      ports: [443, 8443]
    
    # é»˜è®¤å—…æ¢ 80
    HTTP: # éœ€è¦å—…æ¢çš„ç«¯å£
      
      ports: [80, 8080-8880]
      # å¯è¦†ç›– sniffer.override-destination
      override-destination: true
  force-domain:
    - '+.netflix.com'
    - '+.nflxvideo.net'
    - '+.amazonaws.com'
    - '+.media.dssott.com'
    - '+.v2ex.com'
  # å¯¹å—…æ¢ç»“æœè¿›è¡Œè·³è¿‡
  skip-domain:
    - '+.apple.com'
    - Mijia Cloud
    - dlg.io.mi.com
  # éœ€è¦å—…æ¢åè®®
