# 混合端口 HTTP和SOCKS5用一个端口
mixed-port: 7890

# Linux 和 macOS 的 redir 代理端口 (如需使用此功能，请取消注释)
# redir-port: 7892

# Transparent proxy server port for Linux (TProxy TCP and TProxy UDP)
tproxy-port: 7893

geodata-mode: true         #【Meta专属】使用geoip.dat数据库(默认：false使用mmdb数据库)
tcp-concurrent: true         #【Meta专属】TCP连接并发，如果域名解析结果对应多个IP，
                             # 并发所有IP，选择握手最快的IP进行连接

# 允许局域网的连接（可用来共享代理）
allow-lan: true

bind-address: "*"
ipv6: true # 开启 IPv6 总开关，关闭阻断所有 IPv6 链接和屏蔽 DNS 请求 AAAA 记录

#  find-process-mode has 3 values:always, strict, off
#  - always, 开启，强制匹配所有进程
#  - strict, 默认，由 clash 判断是否开启
#  - off, 不匹配进程，推荐在路由器上使用此模式
find-process-mode: strict
# 规则模式：rule（规则） / global（全局代理）/ direct（全局直连）/ script (脚本)
mode: rule
#自定义 geodata url
geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat"
  mmdb: "https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb"
# 设置日志输出级别 (默认级别：silent，即不输出任何内容，以避免因日志内容过大而导致程序内存溢出）。
# 5 个级别：silent / error / warning / info / debug。级别越高日志输出量越大，越倾向于调试，若需要请自行开启。
log-level: debug

# Clash 的 RESTful API
external-controller: '127.0.0.1:7921'

# 实验性功能
experimental:
  ignore-resolve-fail: true # 忽略 DNS 解析失败，默认值为 true
  # interface-name: en0 # outbound interface name

# 全局 TLS 指纹，优先低于 proxy 内的 client-fingerprint
# 可选： "chrome","firefox","safari","ios","random","none" options.
# Utls is currently support TLS transport in TCP/grpc/WS/HTTP for VLESS/Vmess and trojan.
global-client-fingerprint: random

keep-alive-interval: 600

profile: # 存储 select 选择记录
  store-selected: true
  # 持久化 fake-ip
  store-fake-ip: true
unified-delay: true # 更换延迟计算方式，去除握手等额外延迟
tcp-concurrent: true # TCP 并发
# DNS 分流支持 GeoSite
dns:
  enable: true # 是否启用dns false
  prefer-h3: true # 开启 DoH 支持 HTTP/3，将并发尝试
  ipv6: true
  listen: 0.0.0.0:53
  enhanced-mode: redir-host       #DNS模式(redir-host/fake-ip)
                                     #【Meta专属】redir-host传递域名，可远程解析
  fake-ip-range: 198.18.0.1/16 #
  fake-ip-filter: # fake ip 白名单列表，如果你不知道这个参数的作用，请勿修改
     - '*.lan'
     - '*.linksys.com'
     - '+.pool.ntp.org'
     - localhost.ptlogin2.qq.com
     - +.stun.*.*
     - +.stun.*.*.*
     - +.stun.*.*.*.*
     - +.stun.*.*.*.*.*
     - lens.l.google.com
     - '*.n.n.srv.nintendo.net'
     - +.stun.playstation.net
     - xbox.*.*.microsoft.com
     - '*.*.xboxlive.com'
     - '*.msftncsi.com'
     - '*.msftconnecttest.com'
     - '*.mcdn.bilivideo.cn'
     - WORKGROUP
  default-nameserver:
     - https://223.5.5.5/dns-query
     - https://119.29.29.29/dns-query
     - https://8.8.4.4/dns-query
     - https://1.0.0.1/dns-query
     - https://9.9.9.11/dns-query
  proxy-server-nameserver:          #【Meta专属】解析代理服务器域名的dns
     - https://dns.alidns.com/dns-query              # 不写时用nameserver解析
     - https://cloudflare-dns.com/dns-query
     - https://dns.google/dns-query
     - https://dns11.quad9.net/dns-query
     - https://doh.dns.sb/dns-query
     - tls://dns.sb
  nameserver-policy:
    "geosite:cn,private,apple": 
      - https://dns.alidns.com/dns-query
      - https://doh.pub/dns-query
      - tls://dns.alidns.com
      - tls://dot.pub
      - system
  nameserver:
     - https://mozilla.cloudflare-dns.com/dns-query
     - https://doh.dns.sb/dns-query
     - https://dns.cloudflare.com/dns-query
     - https://dns.google/dns-query
     - https://doh.opendns.com/dns-query

  fallback:
     - https://cloudflare-dns.com/dns-query
     - https://dns.google/dns-query
     - https://dns11.quad9.net/dns-query
     - https://doh.dns.sb/dns-query
     - tls://1.0.0.1:853
     - tls://dns.google:853
     - tls://dns11.quad9.net
     - tls://dns.sb

  fallback-filter:                   #回落DNS服务器过滤
    geoip: true                      #为真时，不匹配为geoip规则的使用fallback返回结果
    geoip-code: CN                   #geoip匹配区域设定
    ipcidr:                          #列表中的ip使用fallback返回解析结果
      - 240.0.0.0/4
      - 127.0.0.1/32
      - 0.0.0.0/32
    domain:                          #列表中的域名使用fallback返回解析结果
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'

  use-hosts: true

#ebpf配置
ebpf:
  auto-redir: # redirect 模式，仅支持 TCP
    - eth0
  redirect-to-tun: # UDP+TCP 使用该功能请勿启用 auto-route
    - eth0
    
sniffer:
  enable: true
  ## 对 redir-host 类型识别的流量进行强制嗅探
  ## 如：Tun、Redir 和 TProxy 并 DNS 为 redir-host 皆属于
  # force-dns-mapping: false
  ## 对所有未获取到域名的流量进行强制嗅探
  # parse-pure-ip: false
  # 是否使用嗅探结果作为实际访问，默认 true
  # 全局配置，优先级低于 sniffer.sniff 实际配置
  override-destination: false
  sniff: # TLS 默认如果不配置 ports 默认嗅探 443
    TLS:
      ports: [443, 8443]
    
    # 默认嗅探 80
    HTTP: # 需要嗅探的端口
      
      ports: [80, 8080-8880]
      # 可覆盖 sniffer.override-destination
      override-destination: true
  force-domain:
    - +.v2ex.com
  # 对嗅探结果进行跳过
  skip-domain:
    - Mijia Cloud
  # 需要嗅探协议

# Clash for Windows
# Proxies module latency test settings
cfw-latency-timeout: 3000
cfw-latency-url: http://www.gstatic.com/generate_204

# 打断连接
# Identify strategy of breaking connections after switching to a new proxy/profile/mode
# Options for proxy: none, chain(proxy group in connection chains), all
# Options for profile: true, false
# Options for mode: true, false
cfw-conn-break-strategy:
  proxy: none # none/chain/all
  profile: true # true/false
  mode: false # true/false

# 自定义节点排序
# 可选参数：
#  default：按配置文件定义节点顺序
#  latency：按节点延迟升序排列
#  alphabet：按节点名称字母表排列
# Sort proxies in Proxies module by default/latency/alphabet
cfw-proxies-order: latency
